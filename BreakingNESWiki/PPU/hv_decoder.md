# H/V Декодер

![ppu_locator_hv_dec](/BreakingNESWiki/imgstore/ppu/ppu_locator_hv_dec.jpg)

H/V-декодер выбирает нужные пиксели и строки для H/V-логики.

Под "пикселем" понимается временной интервал, который базируется на PCLK. Не все "пиксели" отображаются как изображение, часть определяют различные управляющие порции сигнала, типа HSync, Color Burst и проч.

Принцип работы заключается в следующем:
- Входы находятся слева, выходы снизу. Входы для разрядов счётчика следуют в порядке сверху-вниз, начиная с msb, например: H8, /H8, H7, /H7 и т.д.
- Прямые и инверсные входы нужны чтобы проверить значение соответствующего разряда на `0` или `1`. Например, если разряд H8=1 и в декодере имеется транзистор, то выход "обнуляется" (неактивен).
- Каждый выход принимает значение `1` только для требуемых значений H или V
- H Decoder имеет 2 дополнительных входа: VB и BLNK, которые отсекают соответствующие выходы, когда VB=1 или BLNK=1
- Технически каждая линейка декодера представляет собой многовходовый вентиль NOR

Ещё одной топологической особенностью H/V декодера является левый нижний угол, выходы с которого идут не вниз, а налево, в схему Front Porch.

## Декодер H

![ntsc_h](/BreakingNESWiki/imgstore/ppu/ntsc_h.png)

|Выход HPLA|Номера пикселей строки|Битовая маска|VB Tran|BLNK Tran|Смысловое значение/с чем связан|
|---|---|---|---|---|---|
|0|279|01101010011001010100| | |FPorch FF|
|1|256|01101010101010101000| | |FPorch FF|
|2|65|10100110101010100101| |yes|S/EV|
|3|0-7, 256-263|00101010101000000000| | |CLIP_O / CLIP_B|
|4|0-255|10000000000000000010|yes| |CLIP_O / CLIP_B|
|5|339|01100110011010010101| |yes|0/HPOS (также /EVAL)|
|6|63|10101001010101010101| |yes|/EVAL|
|7|255|00010101010101010101| |yes|E/EV (также /EVAL)|
|8|0-63|10101000000000000001| |yes|I/OAM2|
|9|256-319|01101000000000000001| |yes|PAR/O|
|10|0-255|10000000000000000011|yes|yes|/VIS|
|11|Каждый 0..1|00000000000010100001| |yes|#F/NT|
|12|Каждый 6..7|00000000000001010000| | |F/TB|
|13|Каждый 4..5|00000000000001100000| | |F/TA|
|14|320-335|01000110100000000001| |yes|/FO|
|15|0-255|10000000000000000001| |yes|F/AT|
|16|Каждый 2..3|00000000000010010000| | |F/AT|
|17|270|01101010100101011000| | |BPorch FF|
|18|328|01100110100110101000| | |BPorch FF|
|19|279|01101010011001010100| | |HBlank FF|
|20|304|01101001011010101000| | |HBlank FF|
|21|323|01100110101010010100| | |BURST FF|
|22|308|01101001011001101000| | |BURST FF|
|23|340|01100110011001101000| | |HCounter clear / VCounter step|

![H_Decoder](/BreakingNESWiki/imgstore/ppu/H_Decoder.jpg)

## Декодер V

![ntsc_v](/BreakingNESWiki/imgstore/ppu/ntsc_v.png)

|Выход VPLA|Номер строки|Битовая маска|Смысловое значение|
|---|---|---|---|
|0|247|000101010110010101|VSYNC FF|
|1|244|000101010110011010|VSYNC FF|
|2|261|011010101010011001|PICTURE FF|
|3|241|000101010110101001|PICTURE FF|
|4|241|000101010110101001|/VSET|
|5|0|101010101010101010|VB FF|
|6|240|000101010110101010|VB FF, BLNK FF|
|7|261|011010101010011001|BLNK FF|
|8|261|011010101010011001|VCLR|

![V_Decoder](/BreakingNESWiki/imgstore/ppu/V_Decoder.jpg)
